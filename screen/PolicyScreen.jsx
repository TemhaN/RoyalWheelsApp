import React from 'react';
import {
  View,
  Text,
  TouchableOpacity,
  FlatList,
  StyleSheet,
  SafeAreaView,
  Platform,
} from 'react-native';
import { ArrowLeft } from 'lucide-react-native';

export default function PolicyScreen({ navigation }) {
  const sections = [
    {
      title: '1. Общие положения',
      content: `1.1. Настоящее Пользовательское соглашение (далее – Соглашение) регулирует отношения между сервисом RoyalWheels (далее – Арендодатель) и физическим лицом (далее – Пользователь) по предоставлению услуг аренды автомобилей через мобильное приложение RoyalWheels.\n1.2. Соглашение разработано в соответствии с законодательством Республики Казахстан, включая Гражданский кодекс РК, Закон РК "О защите прав потребителей" № 316-V от 21 мая 2013 года, Закон РК "О дорожном движении" № 339-IV от 17 апреля 2014 года, Закон РК "Об обязательном страховании гражданско-правовой ответственности владельцев транспортных средств" № 580-II от 1 июля 2003 года и Закон РК "О персональных данных и их защите" № 94-V от 21 мая 2013 года.\n1.3. Регистрация в приложении означает полное и безоговорочное принятие Пользователем условий Соглашения.\n1.4. Арендодатель оставляет за собой право вносить изменения в Соглашение, уведомляя Пользователя через приложение или по электронной почте.`,
    },
    {
      title: '2. Условия предоставления услуг',
      content: `2.1. Пользователь обязуется предоставить достоверные данные при регистрации, включая полное имя, адрес электронной почты, номер телефона и пароль.\n2.2. Пользователь должен быть не моложе 21 года и иметь действующее водительское удостоверение, выданное в соответствии с законодательством РК.\n2.3. Арендодатель вправе отказать в предоставлении услуг без объяснения причин, если данные Пользователя вызывают сомнения в их достоверности.\n2.4. Пользователь обязуется использовать арендованный автомобиль исключительно в личных целях, за исключением случаев, оговоренных в договоре аренды.`,
    },
    {
      title: '3. Правила эксплуатации автомобиля',
      content: `3.1. Пользователь обязуется соблюдать Правила дорожного движения РК, утверждённые Постановлением Правительства РК № 1196 от 11 октября 2013 года.\n3.2. Запрещается передавать управление автомобилем третьим лицам без письменного согласия Арендодателя. Нарушение влечёт штраф в размере 50 МРП (месячный расчётный показатель, установленный в РК).\n3.3. Пользователь обязан обеспечить сохранность автомобиля, включая его кузов, салон, технические узлы и дополнительное оборудование.\n3.4. Запрещается использовать автомобиль в коммерческих целях, для участия в гонках, обучения вождению или перевозки опасных грузов.\n3.5. Курение, употребление алкоголя или наркотических веществ в автомобиле запрещено. Нарушение влечёт штраф в размере 20 МРП.`,
    },
    {
      title: '4. Ответственность за ущерб',
      content: `4.1. В случае повреждения автомобиля по вине Пользователя, он обязан возместить ущерб в полном объёме в соответствии со статьёй 917 Гражданского кодекса РК.\n4.2. Пользователь несёт ответственность за утрату автомобиля или его комплектующих, включая ключи, документы и дополнительное оборудование.\n4.3. В случае умышленного повреждения автомобиля Пользователь несёт уголовную ответственность по статье 202 УК РК ("Умышленное уничтожение или повреждение имущества").\n4.4. Арендодатель вправе удержать залоговую сумму (если применимо) для покрытия ущерба до выяснения обстоятельств.\n4.5. Если ущерб покрывается страховкой, Пользователь обязан оплатить франшизу, установленную страховой компанией.`,
    },
    {
      title: '5. Ответственность за кражу или угон',
      content: `5.1. В случае кражи или угона автомобиля Пользователь обязан немедленно уведомить Арендодателя и правоохранительные органы.\n5.2. Если кража или угон произошли по вине Пользователя (например, оставление ключей в автомобиле), он несёт полную материальную ответственность за утрату автомобиля.\n5.3. Умышленный угон автомобиля Пользователем влечёт уголовную ответственность по статье 188 УК РК ("Кража") или статье 200 УК РК ("Неправомерное завладение автомобилем").\n5.4. Пользователь обязан предоставить все необходимые документы для расследования, включая заявление в полицию.`,
    },
    {
      title: '6. Ответственность за причинение вреда',
      content: `6.1. Пользователь несёт полную ответственность за причинение вреда жизни, здоровью или имуществу третьих лиц в результате эксплуатации автомобиля.\n6.2. В случае ДТП, повлекшего травмы или смерть, Пользователь обязан действовать в соответствии со статьёй 611 Кодекса РК об административных правонарушениях и статьёй 344 УК РК ("Нарушение ПДД, повлекшее тяжкий вред здоровью или смерть").\n6.3. Арендодатель не несёт ответственности за действия Пользователя, если они совершены вне условий договора аренды.\n6.4. Пользователь обязан немедленно уведомить Арендодателя о любом ДТП, предоставив фото- и видеоматериалы с места происшествия.`,
    },
    {
      title: '7. Страхование',
      content: `7.1. Все автомобили застрахованы по обязательному страхованию гражданско-правовой ответственности (ОГПО) в соответствии с Законом РК № 580-II.\n7.2. Дополнительное страхование (КАСКО) оформляется по желанию Пользователя за дополнительную плату.\n7.3. Страховка не покрывает ущерб, причинённый умышленно, в состоянии алкогольного или наркотического опьянения, либо при нарушении условий договора аренды.\n7.4. Пользователь обязан уведомить страховую компанию и Арендодателя о страховом случае в течение 24 часов.\n7.5. В случае отказа страховой компании в выплате Пользователь обязан покрыть ущерб самостоятельно.`,
    },
    {
      title: '8. Штрафы за нарушения ПДД',
      content: `8.1. Пользователь обязан оплатить все штрафы за нарушения ПДД, полученные в период аренды, в соответствии с Кодексом РК об административных правонарушениях.\n8.2. Арендодатель вправе взыскать сумму штрафа с Пользователя, включая административные расходы, через судебный порядок.\n8.3. Пользователь обязан предоставить Арендодателю квитанции об оплате штрафов по запросу.\n8.4. Неуплата штрафов влечёт приостановление доступа к услугам RoyalWheels.`,
    },
    {
      title: '9. Конфиденциальность и защита данных',
      content: `9.1. Персональные данные Пользователя обрабатываются в соответствии с Законом РК "О персональных данных и их защите" № 94-V.\n9.2. Арендодатель обязуется не передавать данные третьим лицам без согласия Пользователя, за исключением случаев, предусмотренных законодательством.\n9.3. Пользователь даёт согласие на обработку своих данных для целей предоставления услуг, включая передачу данных страховым компаниям и правоохранительным органам при необходимости.\n9.4. Арендодатель использует современные средства защиты данных, включая шифрование, для предотвращения несанкционированного доступа.`,
    },
    {
      title: '10. Форс-мажор',
      content: `10.1. Стороны освобождаются от ответственности за неисполнение обязательств вследствие обстоятельств непреодолимой силы, предусмотренных статьёй 359 Гражданского кодекса РК (стихийные бедствия, военные действия и т.д.).\n10.2. Сторона, ссылающаяся на форс-мажор, обязана уведомить другую сторону в течение 3 рабочих дней.\n10.3. В случае форс-мажора сроки исполнения обязательств продлеваются на период действия обстоятельств.`,
    },
    {
      title: '11. Порядок расторжения договора',
      content: `11.1. Пользователь вправе расторгнуть договор аренды, уведомив Арендодателя за 24 часа до возврата автомобиля.\n11.2. Арендодатель вправе расторгнуть договор в одностороннем порядке в случае нарушения Пользователем условий Соглашения.\n11.3. При расторжении договора Пользователь обязан вернуть автомобиль в исправном состоянии, за исключением нормального износа.`,
    },
    {
      title: '12. Разрешение споров',
      content: `12.1. Все споры, возникающие из Соглашения, разрешаются в претензионном порядке. Претензия направляется в письменной форме и рассматривается в течение 14 рабочих дней.\n12.2. При недостижении согласия споры рассматриваются в судах Республики Казахстан по месту регистрации Арендодателя в соответствии с законодательством РК.\n12.3. Применимым правом является законодательство Республики Казахстан.`,
    },
    {
      title: '13. Прочие условия',
      content: `13.1. Соглашение вступает в силу с момента регистрации и действует до его расторжения.\n13.2. Все уведомления направляются через приложение или на электронную почту Пользователя.\n13.3. Пользователь подтверждает, что ознакомился с условиями Соглашения и обязуется их соблюдать.`,
    },
  ];

  const renderItem = ({ item }) => (
    <View style={styles.section}>
      <Text style={styles.sectionTitle}>{item.title}</Text>
      <Text style={styles.text}>{item.content}</Text>
    </View>
  );

  return (
    <SafeAreaView style={styles.safeArea}>
      <View style={styles.header}>
        <TouchableOpacity
          style={styles.backButton}
          onPress={() => navigation.goBack()}
          activeOpacity={0.7}
        >
          <ArrowLeft width={24} height={24} color="#1A56DB" />
        </TouchableOpacity>
        <Text style={styles.title}>Пользовательское соглашение</Text>
        <View style={styles.placeholder} />
      </View>
      <FlatList
        data={sections}
        renderItem={renderItem}
        keyExtractor={(item, index) => `section-${index}`}
        contentContainerStyle={styles.listContent}
        style={styles.list}
        scrollEnabled={true}
        showsVerticalScrollIndicator={true}
        onContentSizeChange={(width, height) =>
          console.log(`FlatList content size: ${width}x${height}`)
        }
        onScroll={(e) =>
          console.log(`Scroll position: ${e.nativeEvent.contentOffset.y}`)
        }
      />
      <TouchableOpacity
        style={styles.bottomButton}
        onPress={() => navigation.goBack()}
        activeOpacity={0.7}
      >
        <Text style={styles.bottomButtonText}>Назад</Text>
      </TouchableOpacity>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  safeArea: {
    flex: 1,
    backgroundColor: '#F6F8FA',
    ...(Platform.OS === 'web' && {
      minHeight: '100vh',
    }),
  },
  header: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 16,
    paddingVertical: 12,
    backgroundColor: '#FFFFFF',
    borderBottomWidth: 1,
    borderBottomColor: '#E5E7EB',
    elevation: 3,
  },
  backButton: {
    padding: 8,
    borderRadius: 8,
    backgroundColor: '#F3F4F6',
  },
  title: {
    fontSize: 20,
    fontWeight: '700',
    color: '#1C2526',
    textAlign: 'center',
    flex: 1,
  },
  placeholder: {
    width: 40,
  },
  list: {
    flex: 1,
    ...(Platform.OS === 'web' && {
      overflowY: 'auto',
      maxHeight: 'calc(100vh - 150px)', // Учитываем высоту header и bottomButton
    }),
  },
  listContent: {
    paddingHorizontal: 16,
    paddingTop: 16,
    paddingBottom: 100,
  },
  section: {
    backgroundColor: '#FFFFFF',
    borderRadius: 12,
    padding: 16,
    marginBottom: 16,
    elevation: 3,
  },
  sectionTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: '#1A56DB',
    marginBottom: 8,
  },
  text: {
    fontSize: 14,
    color: '#1C2526',
    lineHeight: 24,
  },
  bottomButton: {
    backgroundColor: '#1A56DB',
    borderRadius: 12,
    paddingVertical: 12,
    marginHorizontal: 16,
    marginBottom: 16,
    alignItems: 'center',
    elevation: 5,
  },
  bottomButtonText: {
    fontSize: 16,
    fontWeight: '600',
    color: '#FFFFFF',
  },
});